<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline HTML Code Viewer & Editor</title>
    <!-- Load Tailwind CSS via CDN for responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load ACE Editor for professional code editing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.37.1/ace.js"></script>
    <!-- Load JS Beautifier for code formatting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.15.1/beautify-html.min.js"></script>
    <style>
        /* Custom styles */
        body { font-family: 'Inter', sans-serif; height: 100vh; margin: 0; display: flex; flex-direction: column; overflow: hidden; }
        /* Style for the ACE editor container */
        #editor {
            width: 100%;
            height: 100%;
            min-height: 300px;
            font-size: 14px;
            border-radius: 0.5rem;
        }
        /* Style for the iframe preview */
        #livePreview {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
        }
        /* Ensure the main content area takes remaining height */
        #content-area {
            flex-grow: 1;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header & Controls -->
    <header class="bg-white shadow-lg p-3">
        <div class="flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0 max-w-7xl mx-auto">
            <!-- Modernized H1 Title with Gradient -->
            <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 tracking-tight">
                HTML Editor
            </h1>
            <div class="flex flex-wrap gap-2">
                
                <!-- Import Button -->
                <input type="file" id="fileInput" accept=".html" class="hidden" onchange="importCode()">
                <button onclick="document.getElementById('fileInput').click()" 
                        class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300">
                    Import .html
                </button>

                <!-- Export Button -->
                <button onclick="exportCode()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300">
                    Export Code
                </button>
                
                <!-- Format Button -->
                <button onclick="formatCode()" 
                        class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300">
                    Format Code
                </button>

                <!-- Open in New Tab Button -->
                <button onclick="runInNewTab()" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300">
                    Run in New Tab
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Area: Split View -->
    <div id="content-area" class="max-w-7xl mx-auto w-full p-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
        
        <!-- Editor Panel -->
        <div class="bg-white rounded-xl shadow-2xl flex flex-col overflow-hidden">
            <!-- Modernized H2 Title for Editor -->
            <h2 class="p-3 text-xl font-semibold bg-indigo-50 text-indigo-800 border-b border-indigo-200 tracking-wide">
                HTML Code Editor
            </h2>
            <div id="editor" class="flex-grow">
                &lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;My Live Page&lt;/title&gt;
    &lt;style&gt;
        body { font-family: sans-serif; background-color: #f0f0f0; padding: 20px; text-align: center; }
        h1 { color: #333; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: inline-block; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="card"&gt;
        &lt;h1&gt;Live Preview is Working!&lt;/h1&gt;
        &lt;p&gt;Edit the code on the left to see instant changes here.&lt;/p&gt;
        &lt;button onclick="alert('Hello from the iframe!')" style="background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;"&gt;Click Me&lt;/button&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="bg-white rounded-xl shadow-2xl flex flex-col overflow-hidden">
            <!-- Modernized H2 Title for Preview -->
            <h2 class="p-3 text-xl font-semibold bg-indigo-50 text-indigo-800 border-b border-indigo-200 tracking-wide">
                Live Preview
            </h2>
            <iframe id="livePreview" title="Live HTML Preview" srcdoc="" class="flex-grow"></iframe>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        let editor;
        
        // --- Core Functions ---

        /**
         * Initializes the ACE editor and sets up the live update listener.
         */
        function initializeEditor() {
            // Check if ACE is available
            if (typeof ace === 'undefined') {
                console.error("ACE Editor failed to load.");
                document.getElementById('editor').textContent = "Error: ACE Editor library failed to load from CDN. Please check your internet connection and reload.";
                return;
            }

            editor = ace.edit("editor");
            editor.setTheme("ace/theme/chrome");
            editor.getSession().setMode("ace/mode/html");
            editor.setOptions({
                fontSize: "14pt",
                wrap: true,
                useWorker: false, // Disable web worker validation for better offline performance
            });

            // Set initial content and run the first update
            updatePreview();

            // Set up listener for real-time updates
            editor.getSession().on('change', () => {
                // Throttle updates slightly for performance
                clearTimeout(window.previewTimer);
                window.previewTimer = setTimeout(updatePreview, 200);
            });
        }

        /**
         * Updates the content of the live preview iframe.
         */
        function updatePreview() {
            if (!editor) return;
            const code = editor.getValue();
            const iframe = document.getElementById('livePreview');
            
            // Setting srcdoc is the fastest way to render HTML in an iframe
            // We use setTimeout to ensure it runs asynchronously and doesn't block the UI
            setTimeout(() => {
                iframe.srcdoc = code;
            }, 0);
        }

        /**
         * Imports an HTML file from the user's computer into the editor.
         */
        function importCode() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                console.warn("No file selected.");
                return;
            }

            if (!file.name.toLowerCase().endsWith('.html')) {
                // IMPORTANT: Replacing alert() with a console warning as per instructions.
                console.warn('Import failed: Please select a valid .html file.');
                return;
            }

            const reader = new FileReader();

            reader.onload = (e) => {
                if (editor) {
                    editor.setValue(e.target.result, 1); // Set value, cursor at end
                    updatePreview();
                }
            };

            reader.onerror = () => {
                console.error("Error reading file:", reader.error);
                // IMPORTANT: Replacing alert() with a console warning as per instructions.
                console.warn("Import failed: Failed to read file.");
            };

            reader.readAsText(file);
        }

        /**
         * Exports the current editor content as an HTML file.
         */
        function exportCode() {
            if (!editor) return;
            const code = editor.getValue();
            const blob = new Blob([code], { type: 'text/html' });
            
            // Create a temporary link element
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'exported_code.html';
            
            // Programmatically click the link to trigger the download
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(a.href); // Clean up the object URL
        }

        /**
         * Opens the current HTML code in a new, isolated browser tab (about:blank).
         */
        function runInNewTab() {
            if (!editor) return;
            const code = editor.getValue();
            
            const newWindow = window.open('about:blank', '_blank');
            if (newWindow) {
                // Write the code directly to the new window's document
                newWindow.document.write(code);
                newWindow.document.close();
            } else {
                // IMPORTANT: Replacing alert() with a console warning as per instructions.
                console.warn("Run failed: The new tab was blocked by the browser. Please allow popups for this page.");
            }
        }

        /**
         * Formats the HTML code using js-beautify.
         */
        function formatCode() {
            if (!editor || typeof html_beautify === 'undefined') {
                // IMPORTANT: Replacing alert() with a console warning as per instructions.
                console.warn("Format failed: Formatting library not loaded.");
                return;
            }
            const currentCode = editor.getValue();
            // Use the beautify library to format the HTML
            const formattedCode = html_beautify(currentCode, {
                indent_size: 4,
                indent_char: ' ',
                unformatted: ['a', 'sub', 'sup', 'b', 'i', 'u', 'span'],
                wrap_line_length: 80,
                preserve_newlines: true
            });
            editor.setValue(formattedCode, -1); // Set value, cursor at start
        }

        // --- Initialization ---

        // Wait for the document to fully load before initializing the editor
        window.onload = initializeEditor;
    </script>
</body>
</html>
